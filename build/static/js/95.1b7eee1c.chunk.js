"use strict";(self.webpackChunkoptimized_chatbot_frontend=self.webpackChunkoptimized_chatbot_frontend||[]).push([[95,320],{95:(e,t,s)=>{s.r(t),s.d(t,{default:()=>c});var a=s(43),r=s(838),l=s(320),i=s(339),n=s(579);const c=function(){const[e,t]=(0,a.useState)([]),[s,c]=(0,a.useState)(""),[d,o]=(0,a.useState)([]),[m,x]=(0,a.useState)(null),[h,u]=(0,a.useState)(!1),[g,y]=(0,a.useState)(!0),[p,f]=(0,a.useState)("rag"),b=(0,a.useRef)(null);(0,a.useEffect)(()=>{v()},[]),(0,a.useEffect)(()=>{j()},[e]);const j=()=>{var e;null===(e=b.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},v=async()=>{try{y(!0);const e=await r.K.getConversations();o(e),0===e.length&&f("general")}catch(e){i.Ay.error("Failed to load chat history")}finally{y(!1)}};return(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 h-[calc(100vh-8rem)] flex",children:[(0,n.jsxs)("div",{className:"w-80 border-r border-gray-200 flex flex-col",children:[(0,n.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"\ud83d\udcac Chat History"}),(0,n.jsx)("button",{onClick:()=>{x(null),t([])},className:"w-full mt-3 btn-primary",children:"\u2795 New Chat"})]}),(0,n.jsxs)("div",{className:"p-4 flex space-x-2",children:[(0,n.jsx)("button",{className:"flex-1 px-3 py-1 rounded ".concat("general"===p?"bg-primary-600 text-white":"bg-gray-100 text-gray-700"),onClick:()=>f("general"),children:"General Chat"}),(0,n.jsx)("button",{className:"flex-1 px-3 py-1 rounded ".concat("rag"===p?"bg-primary-600 text-white":"bg-gray-100 text-gray-700"," ").concat(0===d.length?"opacity-50 cursor-not-allowed":""),onClick:()=>d.length>0&&f("rag"),disabled:0===d.length,title:0===d.length?"Upload documents to enable RAG mode":"",children:"Document Chat"})]}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto",children:g?(0,n.jsxs)("div",{className:"p-4 text-center",children:[(0,n.jsx)(l.default,{size:"medium"}),(0,n.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"Loading..."})]}):d.length>0?(0,n.jsx)("div",{className:"p-2",children:d.map(e=>{return(0,n.jsxs)("div",{className:"p-3 mb-2 rounded-lg cursor-pointer transition-colors ".concat((null===m||void 0===m?void 0:m.id)===e.id?"bg-primary-50 border-l-4 border-primary-500":"hover:bg-gray-50"),onClick:()=>(async e=>{try{u(!0);const s=await r.K.getConversationMessages(e);x(d.find(t=>t.id===e)),t(s)}catch(s){i.Ay.error("Failed to load conversation")}finally{u(!1)}})(e.id),children:[(0,n.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.title}),(0,n.jsx)("p",{className:"text-xs text-gray-500",children:(s=e.created_at,new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}))})]},e.id);var s})}):(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-4 text-center",children:[(0,n.jsx)("span",{className:"text-4xl mb-3",children:"\ud83d\udcac"}),(0,n.jsx)("p",{className:"text-gray-500 text-sm",children:"No chat history yet"})]})})]}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,n.jsxs)("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:["\u2728 ",m?m.title:"AI RAG Chat"]}),(0,n.jsx)("p",{className:"text-sm text-gray-500"})]}),(0,n.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[0===e.length?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"rag"===p?"Start a RAG conversation":"Start a general chat"}),(0,n.jsx)("p",{className:"text-gray-500 max-w-sm mb-6",children:"rag"===p?"Ask questions about your uploaded documents.":"Chat freely without document context."})]}):(0,n.jsxs)(n.Fragment,{children:[e.map(e=>(0,n.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,n.jsxs)("div",{className:"max-w-xs lg:max-w-md px-4 py-3 rounded-2xl ".concat("user"===e.role?"bg-primary-600 text-white ml-auto":"bg-gray-100 text-gray-900"),children:[(0,n.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:e.content}),"assistant"===e.role&&e.context_used&&"rag"===p&&(0,n.jsx)("div",{className:"mt-2 text-xs text-primary-600 flex items-center",children:"\u2728 Answered using knowledge base"}),"assistant"===e.role&&e.sources&&e.sources.length>0&&(0,n.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[(0,n.jsx)("p",{className:"text-xs text-gray-600 mb-2",children:"\ud83d\udcc4 Sources:"}),e.sources.slice(0,2).map((e,t)=>(0,n.jsxs)("div",{className:"text-xs text-gray-500 bg-gray-50 p-2 rounded mb-1",children:[(0,n.jsx)("div",{className:"font-medium",children:e.filename}),e.similarity_score&&(0,n.jsxs)("div",{className:"text-primary-600",children:[Math.round(100*e.similarity_score),"% match"]})]},t))]})]})},e.id)),h&&(0,n.jsx)("div",{className:"flex justify-start",children:(0,n.jsx)("div",{className:"bg-gray-100 px-4 py-3 rounded-2xl",children:(0,n.jsx)(l.default,{size:"small"})})})]}),(0,n.jsx)("div",{ref:b})]}),(0,n.jsxs)("div",{className:"border-t border-gray-200 p-4 bg-gray-50",children:[(0,n.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!s.trim()||h)return;const a=s.trim();c(""),u(!0);const l={id:"temp-".concat(Date.now()),role:"user",content:a,created_at:(new Date).toISOString()};t(e=>[...e,l]);try{const e=await r.K.sendMessage(a,null===m||void 0===m?void 0:m.id,p);t(e=>e.filter(e=>e.id!==l.id));const s=[{id:"user-".concat(Date.now()),role:"user",content:a,created_at:(new Date).toISOString()},{id:"assistant-".concat(Date.now()),role:"assistant",content:e.message,sources:e.sources||[],created_at:(new Date).toISOString(),context_used:e.context_used}];t(e=>[...e,...s]),m&&m.id===e.conversation_id||(x({id:e.conversation_id,title:a.substring(0,50)+(a.length>50?"...":"")}),await v())}catch(n){i.Ay.error("Failed to send message"),t(e=>e.filter(e=>e.id!==l.id))}finally{u(!1)}},className:"flex items-center space-x-3",children:[(0,n.jsx)("input",{type:"text",value:s,onChange:e=>c(e.target.value),placeholder:"rag"===p?"Ask me anything about your documents...":"Chat freely without documents...",className:"flex-1 input-field",disabled:h}),(0,n.jsx)("button",{type:"submit",disabled:h||!s.trim(),className:"btn-primary px-4 disabled:opacity-50",children:h?(0,n.jsx)(l.default,{size:"small",color:"white"}):"\ud83d\ude80"})]}),(0,n.jsx)("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500",children:(0,n.jsx)("span",{children:"\ud83d\udca1 Tip: Upload documents in Knowledge Base to get better answers"})})]})]})]})}},320:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});s(43);var a=s(579);const r=e=>{let{size:t="medium",color:s="primary",className:r=""}=e;return(0,a.jsx)("div",{className:"flex items-center justify-center ".concat(r),children:(0,a.jsx)("div",{className:"loading-spinner ".concat({small:"h-4 w-4",medium:"h-8 w-8",large:"h-12 w-12",xlarge:"h-16 w-16"}[t]," ").concat({primary:"border-primary-600",gray:"border-gray-600",white:"border-white"}[s]),role:"status",children:(0,a.jsx)("span",{className:"sr-only",children:"Loading..."})})})}}}]);
//# sourceMappingURL=95.1b7eee1c.chunk.js.map